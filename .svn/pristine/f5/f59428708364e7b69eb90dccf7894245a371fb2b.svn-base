<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
	"-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.uce.suc.bkg.dao.price.IPricingRuleDao">
	
	<sql id="Base_Column_List">
			id,price_rule_code,org_code,
			org_name,combine_code,combine_name,
			business_mode,combine_type,demand_type,price_type_num,
			rule_type_code,status,status_describe,
			official_version,use_flag,general_flag,delete_flag,
			upgrade_type,utf1,utf2,
			utf3,version,remark,
			create_org,create_emp,create_time,
			update_org,update_emp,update_time
	</sql>
	
	<sql id="Base_Column_Where">
	<where>
	    <if test="id != null">
		and id = #{id}
		</if>
	    <if test="priceRuleCode != null and priceRuleCode != ''">
		and price_rule_code LIKE  CONCAT('%',#{priceRuleCode},'%')
		</if>
	    <if test="orgCode != null and orgCode != ''">
		and org_code = #{orgCode}
		</if>
	    <if test="orgName != null and orgName != ''">
		and org_name = #{orgName}
		</if>
	    <if test="combineCode != null and combineCode != ''">
		and combine_code = #{combineCode}
		</if>
	    <if test="combineName != null and combineName != ''">
		and combine_name = #{combineName}
		</if>
	    <if test="businessMode != null and businessMode != ''">
		and business_mode = #{businessMode}
		</if>
	    <if test="combineType != null and combineType != ''">
		and combine_type = #{combineType}
		</if>
	    <if test="demandType != null and demandType != ''">
		and demand_type = #{demandType}
		</if>
	    <if test="ruleTypeCode != null and ruleTypeCode != ''">
		and rule_type_code = #{ruleTypeCode}
		</if>
		<if test="priceTypeNum != null">
		and price_type_num = #{priceTypeNum}
		</if>
	    <if test="status != null and status != ''">
		and status = #{status}
		</if>
	    <if test="statusDescribe != null and statusDescribe != ''">
		and status_describe = #{statusDescribe}
		</if>
	    <if test="officialVersion != null">
		and official_version = #{officialVersion}
		</if>
		 <if test="useFlag != null">
		and use_flag = #{useFlag}
		</if>
	    <if test="generalFlag != null">
		and general_flag = #{generalFlag}
		</if>
	    <if test="deleteFlag != null">
		and delete_flag = #{deleteFlag}
		</if>
	    <if test="upgradeType != null and upgradeType != ''">
		and upgrade_type = #{upgradeType}
		</if>
	    <if test="utf2 != null">
		and utf2 = #{utf2}
		</if>
	    <if test="utf3 != null">
		and utf3 = #{utf3}
		</if>
	    <if test="version != null">
		and version = #{version}
		</if>
	    <if test="remark != null">
		and remark = #{remark}
		</if>
	    <if test="createOrg != null">
		and create_org = #{createOrg}
		</if>
	    <if test="createEmp != null">
		and create_emp = #{createEmp}
		</if>
	    <if test="createTime != null">
		and create_time = #{createTime}
		</if>
	    <if test="updateOrg != null">
		and update_org = #{updateOrg}
		</if>
	    <if test="updateEmp != null">
		and update_emp = #{updateEmp}
		</if>
	    <if test="updateTime != null">
		and update_time = #{updateTime}
		</if>
		<if test="startTime != null">
		and create_time >= #{startTime} 
		</if>
		<if test="endTime != null">
		and create_time <![CDATA[<=]]> #{endTime}
		</if>
	</where>
	</sql>
	
	<update id="updateById" parameterType="cn.uce.suc.bkg.entity.price.PricingRule">
	UPDATE t_suc_bkg_pricing_rule
	<set>
		<if test="priceRuleCode != null">
		price_rule_code = #{priceRuleCode},
		</if>
		<if test="orgCode != null">
		org_code = #{orgCode},
		</if>
		<if test="orgName != null">
		org_name = #{orgName},
		</if>
		<if test="combineCode != null">
		combine_code = #{combineCode},
		</if>
		<if test="combineName != null">
		combine_name = #{combineName},
		</if>
		<if test="businessMode != null">
		business_mode = #{businessMode},
		</if>
		<if test="combineType != null">
		combine_type = #{combineType},
		</if>
		<if test="demandType != null">
		demand_type = #{demandType},
		</if>
		<if test="ruleTypeCode != null">
		rule_type_code = #{ruleTypeCode},
		</if>
		<if test="priceTypeNum != null">
		price_type_num = #{priceTypeNum},
		</if>
		<if test="status != null">
		status = #{status},
		</if>
		<if test="statusDescribe != null">
		status_describe = #{statusDescribe},
		</if>
		<if test="officialVersion != null">
		official_version = #{officialVersion},
		</if>
		<if test="useFlag != null">
		use_flag = #{useFlag},
		</if>
		<if test="generalFlag != null">
		general_flag = #{generalFlag},
		</if>
		<if test="deleteFlag != null">
		delete_flag = #{deleteFlag},
		</if>
		<if test="upgradeType != null">
		upgrade_type = #{upgradeType},
		</if>
		<if test="utf1 != null">
		utf1 = #{utf1},
		</if>
		<if test="utf2 != null">
		utf2 = #{utf2},
		</if>
		<if test="utf3 != null">
		utf3 = #{utf3},
		</if>
		<if test="version != null">
		version = ifnull(version,0) + 1,
		</if>
		<if test="remark != null">
		remark = #{remark},
		</if>
		<if test="createOrg != null">
		create_org = #{createOrg},
		</if>
		<if test="createEmp != null">
		create_emp = #{createEmp},
		</if>
		<if test="createTime != null">
		create_time = #{createTime},
		</if>
		<if test="updateOrg != null">
		update_org = #{updateOrg},
		</if>
		<if test="updateEmp != null">
		update_emp = #{updateEmp},
		</if>
		<if test="updateTime != null">
		update_time = #{updateTime},
		</if>
	</set>
	WHERE id = #{id}
		<if test="version != null">
			AND version = #{version}
		</if>
	</update>
	
	<select id="findByPagination" parameterType="cn.uce.suc.bkg.vo.price.PricingRuleVo" resultType="cn.uce.suc.bkg.vo.price.PricingRuleVo">
	select <include refid="Base_Column_List" /> from t_suc_bkg_pricing_rule 
	<include refid="Base_Column_Where" />
	ORDER BY create_time DESC
	</select>
	
	<!-- 根据条件查询 -->
	<select id="findByCondition" parameterType="cn.uce.suc.bkg.vo.price.PricingRuleVo" resultType="cn.uce.suc.bkg.vo.price.PricingRuleVo">
		SELECT <include refid="Base_Column_List" />
		FROM t_suc_bkg_pricing_rule
		<include refid="Base_Column_Where" />
	</select>
	
	
	<!-- 根据条件查询报价 -->
	<select id="findPriceByCondtion" parameterType="cn.uce.suc.bkg.vo.price.PricingRuleVo" resultType="cn.uce.suc.bkg.vo.price.PricingRuleVo">
		SELECT pr.*,prd.unit_fixed_cost,prd.unit_change_cost,prdr.org_code AS site_code,prdr.org_name AS site_name
		FROM t_suc_bkg_pricing_rule pr
		LEFT JOIN t_suc_bkg_pricing_rule_detail prd ON pr.price_rule_code = prd.price_rule_code AND prd.delete_flag = '0'
		LEFT JOIN t_suc_bkg_pricing_rule_detail_rel prdr ON prdr.detail_id = prd.id AND prdr.delete_flag = '0'
		<where>
		 	pr.delete_flag = '0' AND pr.status = '02'
			<if test="ruleTypeCode != null and ruleTypeCode != ''">
				AND prd.rule_type_code = #{ruleTypeCode}
			</if>
			<if test="siteCode != null and siteCode != ''">
				AND prdr.org_code = #{siteCode}
			</if>
			<if test="businessMode != null and businessMode != ''">
				AND pr.business_mode = #{businessMode}
			</if>
			<if test="demandType != null and demandType != ''">
				AND pr.demand_type = #{demandType}
			</if>
			<if test="orgCode != null and orgCode != ''">
				AND pr.org_code = #{orgCode}
			</if>
			<if test="priceRuleCode != null and priceRuleCode != ''">
				AND pr.price_rule_code = #{priceRuleCode}
			</if>
			<if test="combineCode != null and combineCode != ''">
				AND pr.combine_code = #{combineCode}
			</if>
		</where>
	</select>
	
	<!-- 选择定价规则 -->
	<select id="findSelectPrice" parameterType="cn.uce.suc.bkg.vo.price.PricingRuleVo" resultType="cn.uce.suc.bkg.vo.price.PricingRuleVo">
		SELECT pr.*
		FROM t_suc_bkg_pricing_rule pr
		<where>
			AND pr.delete_flag = '0'
			<if test="combineCode != null and combineCode != ''">
				AND pr.combine_code = #{combineCode}
			</if>
		</where>
		UNION (
		SELECT pr1.* FROM t_suc_bkg_pricing_rule pr1
		WHERE
			pr1.general_flag = true AND pr1.delete_flag = '0'
			<if test="businessMode != null and businessMode != ''">
				AND pr1.business_mode = #{businessMode}
			</if>
			<if test="demandType != null and demandType != ''">
				AND pr1.demand_type = #{demandType}
			</if>
			<if test="orgCode != null and orgCode != ''">
				AND pr1.org_code = #{orgCode}
			</if>
		)
	</select>
	
</mapper>