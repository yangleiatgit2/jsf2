package cn.uce.suc.bkg.control.datamain;

import java.util.Calendar;
import java.util.Date;
import java.util.Map;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;







import cn.uce.base.page.Page;
import cn.uce.base.page.Pagination;
import cn.uce.suc.bkg.biz.datamain.ICapacityManagementBiz;
import cn.uce.suc.bkg.entity.datamain.CapacityManagement;
import cn.uce.suc.bkg.vo.datamain.CapacityManagementVo;
import cn.uce.suc.common.constants.BkgConstants;
import cn.uce.utils.StringUtil;
import cn.uce.web.common.base.BaseController;
import cn.uce.web.common.i18n.Resources;

@Controller
@RequestMapping("/dotAbility")
public class DotAbilityController extends BaseController{

	
	/**
	 * 注入BIZ
	 */
	@Resource
	private  ICapacityManagementBiz capacityManagementBiz;
	/**
	 * 
	 * @Description: 跳转到页面
	 * @param request
	 * @param response
	 * @return
	 * @author haizhou
	 * @date 2017年11月1日 上午11:20:33
	 */
	@RequestMapping(value = "/forward")
	public String get(HttpServletRequest request, HttpServletResponse response) {
		return "bkg/dotAbility";
	}
	

	/**
	 * 
	 * @Description: 分页条件查询网点运力管理
	 * @param capacityManagementVo  网点运力的查询条件
	 * @param page 分页参数
	 * @return 网点运力
	 * @author haizhou
	 * @date 2017年11月1日 上午11:20:33
	 */
	@RequestMapping(value = "/findBycondition")
	@ResponseBody
	public Map<String, Object> findByCondition(CapacityManagementVo capacityManagementVo, Page page) {
		if(capacityManagementVo.getEndTime()!=null){
			   
			   
	        Calendar c = Calendar.getInstance();  
	        c.setTime(capacityManagementVo.getEndTime());  
	        c.add(Calendar.DAY_OF_MONTH, 1);// 今天+1天  
	        Date tomorrow = c.getTime();  
	        capacityManagementVo.setEndTime(tomorrow);
		}
		Pagination<CapacityManagement> pagination = capacityManagementBiz.findByPagination(capacityManagementVo, page);
		return returnSuccess(pagination);
	}
	
	/**
	 * 
	 * @Description: 根据ID 来修改
	 * @param capacityManagementVo  网点运力
	 * @return 变更的数量
	 * @author haizhou
	 * @date 2017年11月1日 上午11:20:33
	 */
	@PostMapping(value = "/updateCapacityManagementById")
	@ResponseBody
	public Integer updateCapacityManagementById(CapacityManagement capacityManagement){
		
		return capacityManagementBiz.updateCapacityManagement(capacityManagement);
		
	}
	/**
	 * 
	 * @Description: 新增
	 * @param capacityManagementVo  网点运力
	 * @author haizhou
	 * @date 2017年11月1日 上午11:20:33
	 */
	@RequestMapping(value = "/addOne")
	@ResponseBody 
	public Map<String,Object> addOne(CapacityManagement capacityManagement){
			
			int val=capacityManagementBiz.addCapacityManagement(capacityManagement);
			if(val>0){
				return returnSuccess(Resources.getMessage("common.save.success"));
			}
			return returnError(Resources.getMessage("common.save.fail"));
	}
	//编辑
		@RequestMapping(value = "/updateOne")
		@ResponseBody 
		public Map<String,Object> updateOne(CapacityManagement capacityManagement){
			//如果如果是否喊有通行证为false,清空通行证编号
			if(false==capacityManagement.getPassFlag()){
				capacityManagement.setPassImageId("");
			}
				int val=capacityManagementBiz.updateCapacityManagement(capacityManagement);
				if(val>0){
					return returnSuccess(Resources.getMessage("common.update.success"));
				}
				return returnError(Resources.getMessage("common.update.fail"));
		}
	
	
	/**
	 * @Description: 批量发送报价
	 * @param String ids的集合
	 * @param buyStatus 需要修改的状态
	 * @return 修改的条数
	 * @author UCE-haizhou
	 * @date 2017年10月23日 下午06:54:13
	 */
	@PostMapping(value = "/updateSendByIds")
	@ResponseBody
	public Integer updateByIdsAndBuyStatus(String ids){
		
		
		
		return capacityManagementBiz.updateByIdsAndBuyStatus(ids,BkgConstants.CAPACITY_STATUS_OFFER);
		
	}
	/**
	 * @Description: 平台批量确认
	 * @param String ids的集合
	 * @param buyStatus 需要修改的状态
	 * @return 修改的条数
	 * @author UCE-haizhou
	 * @date 2017年10月23日 下午06:54:13
	 */
	@PostMapping(value = "/updateConfirmByIds")
	@ResponseBody
	public Integer updateConfirmByIds(String ids){
		
		
		return capacityManagementBiz.updateConfirmByIds(ids,BkgConstants.CAPACITY_STATUS_PLATFORM_CONFIRM);
		
	}
	/**
	 * @Description:批量终止运力
	 * @param String ids的集合
	 * @param buyStatus 需要修改的状态
	 * @return 修改的条数
	 * @author UCE-haizhou
	 * @date 2017年10月23日 下午06:54:13
	 */
	@PostMapping(value = "/updateStopByIds")
	@ResponseBody
	public Integer updateStopByIds(String ids){
		
		
		return capacityManagementBiz.updateByIdsAndBuyStatus(ids,BkgConstants.CAPACITY_STATUS_END);
		
	}
	/**
	 * @Description: 通过ID来查询信息
	 * @param id
	 * @return capacityManagement
	 * @author UCE-haizhou
	 * @date 2017年10月23日 下午06:54:13
	 */
	@PostMapping(value = "/findById")
	@ResponseBody
	public Map<String, Object> findById(Long id){
		CapacityManagement capacityManagement=capacityManagementBiz.findById(id);
		if(capacityManagement != null){
			return returnSuccess(capacityManagement);
		}else{
			return  returnError(Resources.getMessage("common.get.success"));
		}
		
	}
	/**
	 * @Description: 获取网点运力编号
	 * @param 
	 * @return CapacityCode
	 * @author UCE-haizhou
	 * @date 2017年11月3日 下午06:54:13
	 */
	@PostMapping(value = "/getCapacityCode")
	@ResponseBody
	public String getCapacityCode(){
		
		String capacityCode = capacityManagementBiz.getCapacityCode();
		if( StringUtil.isNotBlank(capacityCode)){
			return capacityCode;
		}else{
			return null;
		}
	}
	
	
}
