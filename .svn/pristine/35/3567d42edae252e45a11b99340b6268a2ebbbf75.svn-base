package cn.uce.suc.bkg.control.infomon;


import java.util.Calendar;
import java.util.Date;
import java.util.Map;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import cn.uce.base.page.Page;
import cn.uce.base.page.Pagination;
import cn.uce.suc.common.biz.imp.NoticeBiz;
import cn.uce.suc.common.constants.BkgConstants;
import cn.uce.suc.common.entity.Notice;
import cn.uce.suc.common.vo.NoticeVo;
import cn.uce.utils.StringUtil;
import cn.uce.web.common.base.BaseController;
import cn.uce.web.common.i18n.Resources;
/**
 * 
 * @Description: 注入消息发布的控制器
 * @author huhaizhou
 * @date 2017年12月3日 上午11:44:55
 */
@Controller
@RequestMapping("/newsPrompt")
public class NewsPromptController extends BaseController{
	
	/**
	 * 注入NoticeBiz
	 */
	@Resource
	NoticeBiz noticeBiz;
	
	/**
	 * 页面跳转
	 * @param request
	 * @param response
	 * @return 跳转的页面
	 */
	@RequestMapping(value = "/forward")
	public String get(HttpServletRequest request, HttpServletResponse response) {
		return "common/newsPrompt";
	}

	/**
	 * @Description: 消息条件分页查询
	 * @param NoticeVo 消息的条件
	 * @return  Notice 条件查询出来的消息结果
	 * @author UCE-haizhou
	 * @date 2017年10月25日 下午13:37:13
	 */
	@RequestMapping(value = "/findByWhere")
	@ResponseBody
	public Map<String, Object> findByCondition(NoticeVo noticeVo, Page page) {
		noticeVo.setDeleteFlag(false);
		if(noticeVo.getUpdateTime()!=null){
			   
	   
	        Calendar c = Calendar.getInstance();  
	        c.setTime(noticeVo.getUpdateTime());  
	        /**
	         * 查询的结束时间加一天
	         */
	        c.add(Calendar.DAY_OF_MONTH, 1);// 今天+1天  
	   
	        Date tomorrow = c.getTime();  
	        noticeVo.setUpdateTime(tomorrow);
		}
		/*if(BkgConstants.NEWS_PLATFORM_PERSON.equals(noticeVo.getPlatform())){
			noticeVo.setPlatform(null);
			noticeVo.setPhone("1");
		}*/
		Pagination<Notice> pagination=noticeBiz.findByPagination(noticeVo, page);
		return returnSuccess(pagination);
	} 
	
	/**
	 * @Description: 新增消息
	 * @param Notice 消息的条件
	 * @return  新增的条数
	 * @author UCE-haizhou
	 * @date 2017年10月25日 下午13:37:13
	 */
	@RequestMapping(value = "/addNews")
	@ResponseBody
	public Map<String, Object> addNews(Notice notice){
		notice.setDeleteFlag(false);
		if(StringUtil.isBlank(notice.getPhone())){
			notice.setPhone(null);
		}
		
		if(noticeBiz.addNotice(notice)>0){
			return returnSuccess(Resources.getMessage("common.save.success"));
		}else{
			return returnError(Resources.getMessage("common.save.fail"));
		}
		
	}
	/**
	 * @Description: 编辑消息
	 * @param Notice 消息的条件
	 * @return  新增的条数
	 * @author UCE-haizhou
	 * @date 2017年10月25日 下午13:37:13
	 */
	@RequestMapping(value = "/updateNews")
	@ResponseBody
	public Map<String, Object> updateNews(Notice notice){
		
		if(StringUtil.isBlank(notice.getPhone())){
			notice.setPhone(null);
		}
		if(noticeBiz.updateNotice(notice)>0){
			return returnSuccess(Resources.getMessage("common.update.success"));
		}else{
			return returnError(Resources.getMessage("common.update.fail"));
		}
		
	}
}
