package cn.uce.suc.common.util;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

/**
 * 
 * 
 * <pre>
 *  http请求工具类
 * </pre>
 *
 * @since 
 *
 * <pre>
 *    modify by uce-shiq on 2017年1月5日下午3:14:02
 *    fix->1.
 *         2.
 * </pre> 
 * @empNo 005688
 * @email shiqi@uce.cn
 */
public class HttpUtil {

  private static Log log = LogFactory.getLog(HttpUtil.class);
  /** 
   * 发起http请求并获取结果 
   *  
   * @param requestUrl 请求地址 
   * @param requestMethod 请求方式（GET、POST） 
   * @param outputStr 提交的数据 
   * @return String 
   */  
  public static String httpRequest(String requestUrl, String requestMethod, String outputStr){  
    String returnStr = "";  
    StringBuffer buffer = new StringBuffer();
    InputStream inputStream = null;
    InputStreamReader inputStreamReader = null;
    BufferedReader bufferedReader = null;
    HttpURLConnection httpUrlConn = null;
    try{
      URL url = new URL(requestUrl);  
      httpUrlConn = (HttpURLConnection) url.openConnection();  
      httpUrlConn.setDoOutput(true);  
      httpUrlConn.setDoInput(true);  
      httpUrlConn.setUseCaches(false);  
      httpUrlConn.setRequestProperty("Content-Type", "application/json;charset=utf-8");
      // 设置请求方式（GET/POST）  
      httpUrlConn.setRequestMethod(requestMethod);  
      //if ("GET".equalsIgnoreCase(requestMethod))  
      httpUrlConn.connect();  
      // 当有数据需要提交时  
      if (null != outputStr) {  
        OutputStream outputStream = httpUrlConn.getOutputStream();  
        // 注意编码格式，防止中文乱码  
        outputStream.write(outputStr.getBytes("UTF-8"));  
        outputStream.close();  
      }  

      // 将返回的输入流转换成字符串  
      inputStream = httpUrlConn.getInputStream();  
      inputStreamReader = new InputStreamReader(inputStream, "utf-8");  
      bufferedReader = new BufferedReader(inputStreamReader);  
      String str = null;  
      while ((str = bufferedReader.readLine()) != null) {  
        buffer.append(str);  
      }  
    
      httpUrlConn.disconnect();  
      returnStr =buffer.toString();
    } catch (IOException e) {
      log.error("Io 异常", e);
    }finally {
      try {
        if (bufferedReader != null) {
          bufferedReader.close();  
        }
        if (inputStreamReader != null) {
          inputStreamReader.close();
        }
        if (inputStream != null) {
          inputStream.close();
          inputStream = null; 
        }
        if (httpUrlConn != null) {
          httpUrlConn.disconnect();  
        }
      } catch (IOException ex) {
        log.error("Io 流关闭异常", ex);
      }
        }  
    return returnStr;  
  }  
}