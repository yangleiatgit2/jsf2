<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
	"-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.uce.suc.common.dao.INoticeDetailDao">
	
	<sql id="Base_Column_List">
			id,contents,jpush_alia,
			user_phone,read_flag,title,
			platform,news_type,business_type,
			top_true,business_id,jpush_flag,
			utf1,utf2,utf3,
			remark,version,delete_flag,
			create_time,create_emp,create_org,
			update_emp,update_org,update_time,
			received_time,display_ways,Jpush_num
	</sql>
	
	<sql id="Base_Column_Where">
	<where>
	    <if test="id != null">
		and id = #{id}
		</if>
	    <if test="contents != null">
		and contents = #{contents}
		</if>
	    <if test="jpushAlia != null">
		and jpush_alia = #{jpushAlia}
		</if>
	    <if test="userPhone != null">
		and user_phone = #{userPhone}
		</if>
	    <if test="readFlag != null">
		and read_flag = #{readFlag}
		</if>
	    <if test="title != null">
		and title = #{title}
		</if>
	    <if test="platform != null">
		and platform = #{platform}
		</if>
	    <if test="newsType != null">
		and news_type = #{newsType}
		</if>
	    <if test="businessType != null">
		and business_type = #{businessType}
		</if>
	    <if test="topTrue != null">
		and top_true = #{topTrue}
		</if>
	    <if test="businessId != null">
		and business_id = #{businessId}
		</if>
	    <if test="jpushFlag != null">
		and jpush_flag = #{jpushFlag}
		</if>
	    <if test="utf1 != null">
		and utf1 = #{utf1}
		</if>
	    <if test="utf2 != null">
		and utf2 = #{utf2}
		</if>
	    <if test="utf3 != null">
		and utf3 = #{utf3}
		</if>
	    <if test="remark != null">
		and remark = #{remark}
		</if>
	    <if test="version != null">
		and version = #{version}
		</if>
	    <if test="deleteFlag != null">
		and delete_flag = #{deleteFlag}
		</if>
	    <if test="createTime != null">
		and create_time = #{createTime}
		</if>
	    <if test="createEmp != null">
		and create_emp = #{createEmp}
		</if>
	    <if test="createOrg != null">
		and create_org = #{createOrg}
		</if>
	    <if test="updateEmp != null">
		and update_emp = #{updateEmp}
		</if>
	    <if test="updateOrg != null">
		and update_org = #{updateOrg}
		</if>
	    <if test="updateTime != null">
		and update_time = #{updateTime}
		</if>
	    <if test="receivedTime != null">
		and received_time = #{receivedTime}
		</if>
	    <if test="displayWays != null and displayWays !=''" >
		and display_ways like "%"#{displayWays}"%"
		</if>
	</where>
	</sql>
	
	<update id="updateById" parameterType="cn.uce.suc.common.entity.NoticeDetail">
	UPDATE t_suc_comm_notice_detail
	<set>
		<if test="contents != null">
		contents = #{contents},
		</if>
		<if test="jpushAlia != null">
		jpush_alia = #{jpushAlia},
		</if>
		<if test="jpushTime != null">
		Jpush_time = #{jpushTime},
		</if>
		<if test="JpushNum != null">
		Jpush_num = #{JpushNum},
		</if>
		<if test="userPhone != null">
		user_phone = #{userPhone},
		</if>
		<if test="readFlag != null">
		read_flag = #{readFlag},
		</if>
		<if test="title != null">
		title = #{title},
		</if>
		<if test="platform != null">
		platform = #{platform},
		</if>
		<if test="newsType != null">
		news_type = #{newsType},
		</if>
		<if test="businessType != null">
		business_type = #{businessType},
		</if>
		<if test="topTrue != null">
		top_true = #{topTrue},
		</if>
		<if test="businessId != null">
		business_id = #{businessId},
		</if>
		<if test="jpushFlag != null">
		jpush_flag = #{jpushFlag},
		</if>
		<if test="utf1 != null">
		utf1 = #{utf1},
		</if>
		<if test="utf2 != null">
		utf2 = #{utf2},
		</if>
		<if test="utf3 != null">
		utf3 = #{utf3},
		</if>
		<if test="remark != null">
		remark = #{remark},
		</if>
		<if test="version != null">
		version = #{version},
		</if>
		<if test="deleteFlag != null">
		delete_flag = #{deleteFlag},
		</if>
		<if test="createTime != null">
		create_time = #{createTime},
		</if>
		<if test="createEmp != null">
		create_emp = #{createEmp},
		</if>
		<if test="createOrg != null">
		create_org = #{createOrg},
		</if>
		<if test="updateEmp != null">
		update_emp = #{updateEmp},
		</if>
		<if test="updateOrg != null">
		update_org = #{updateOrg},
		</if>
		<if test="updateTime != null">
		update_time = #{updateTime},
		</if>
		<if test="receivedTime != null">
		received_time = #{receivedTime},
		</if>
		<if test="displayWays != null">
		display_ways = #{displayWays},
		</if>
	</set>
	WHERE id = #{id}
	</update>
	
	<select id="findByPagination" parameterType="cn.uce.suc.common.vo.NoticeDetailVo" resultType="cn.uce.suc.common.entity.NoticeDetail">
	select <include refid="Base_Column_List" /> from t_suc_comm_notice_detail
	<where>
		<if test="createTime !=null and updateTime != null">
			and create_time between #{createTime} and #{updateTime}
		</if>
		<if test="createTime !=null and updateTime == null">
			and create_time <![CDATA[   >=  ]]> #{createTime}
		</if>
		<if test="createTime == null and updateTime != null">
			and create_time <![CDATA[   <  ]]> #{updateTime}
		</if>
		<if test="platform !=null and platform !=''">
			and platform =#{platform}
		</if>
		<if test="readFlag != null">
			and read_flag =#{readFlag}
		</if>
		<if test="userPhone !=null and userPhone != ''">
			and user_phone =#{userPhone}
		</if>
		<if test="displayWays != null and displayWays != ''">
			and display_ways like  "%"#{displayWays}"%"
		</if>
		<if test="newsType != null  and newsType !=''">
			and news_type =#{newsType}
		</if>
		<if test="appNewTypes != null">
			and news_type  in
			<foreach collection="appNewTypes" index="index" item="item" open="(" separator="," close=")" >
            	#{item}
			</foreach>
		</if>
	</where>
		order by create_time desc , news_type desc 
	</select>
	
	<!-- 获取要推送的消息 begin -->
	<select id="findByJpushFlase" resultType="cn.uce.suc.common.entity.NoticeDetail">
	select
	<include refid="Base_Column_List" />
	from t_suc_comm_notice_detail h where (h.jpush_flag = 0) or
	(5>h.Jpush_num and SYSDATE() > h.Jpush_time and h.jpush_flag=2) 
</select>
	<!-- 获取要推送的消息 end -->
	
	<select id="getIndexNews"  resultType="cn.uce.suc.common.vo.AppNotice" parameterType="cn.uce.suc.common.vo.NoticeDetailVo">
		SELECT id,news_type,title,create_time,business_type,business_id,contents ,read_flag
		from t_suc_comm_notice_detail
		<where>
			<if test="userPhone != null  and '' != userPhone">
				and user_phone = #{userPhone}
			</if>
			<if test="displayWays != null  and '' != displayWays">
				and display_ways like  "%"#{displayWays}"%"
			</if>
			<if test="readFlag != null">
				and read_flag = #{readFlag}
			</if>
			<if test="deleteFlag != null">
				and delete_flag = #{deleteFlag}
			</if>
			<if test="platform != null  and '' != platform">
				and platform = #{platform}
			</if>
		</where>
		order  by  news_type DESC,create_time DESC
	</select>
	<select id="getNewsDetailsById" resultType="cn.uce.suc.common.vo.AppNotice" parameterType="cn.uce.suc.common.vo.NoticeDetailVo">
		SELECT id,news_type,title,create_time,business_type,business_id,contents ,read_flag
		from t_suc_comm_notice_detail
		<where>
		<if test="id != null ">
			and  id = #{id}
		</if>
		</where>
	</select>
	<select id="getAllNews" resultType="cn.uce.suc.common.vo.AppNotice"  parameterType="cn.uce.suc.common.vo.NoticeDetailVo">
		SELECT id,news_type,title,create_time,business_type,business_id,contents,read_flag 
		from t_suc_comm_notice_detail
		<where>
		<if test="userPhone != null and '' != userPhone">
			and  user_phone = #{userPhone}
		</if>
		<if test="deleteFlag != null">
			and delete_flag = #{deleteFlag}
		</if>
		<if test="platform != null and '' != platform">
			and platform = #{platform}
		</if>
		</where>
		 order by read_flag, FIELD(news_type,"02","01","03","00")  ,create_time DESC 
	</select>
	<select id="findPcIndex" resultType="cn.uce.suc.common.entity.NoticeDetail"  parameterType="cn.uce.suc.common.vo.NoticeDetailVo"  >
		SELECT  <include refid="Base_Column_List" />  from  t_suc_comm_notice_detail
			<where>
				<if test="newsType != null and ''  != newsType">
					and news_type = #{newsType}
				</if>
				<if test="readFlag != null">
					and read_flag = #{readFlag}
				</if>
				<if test="deleteFlag != null ">
					and delete_flag = #{deleteFlag}
				</if>
				<if test="platform != null and  '' != platform">
					and  platform = #{platform}
				</if>
			</where>
			order by create_time DESC
	
	</select>
	<select id="getNotReadNewsNumber" parameterType="cn.uce.suc.common.vo.NoticeDetailVo" resultType="java.lang.Integer">
		select count(*) from t_suc_comm_notice_detail
		<where>
			<if test="userPhone != null  and '' != userPhone">
				and user_phone = #{userPhone}
			</if>
			<if test="readFlag != null">
				and  read_flag = #{readFlag}
			</if>
			<if test="platform != null and '' != platform">
				and  platform = #{platform}
			</if>
		
		</where>
	</select>
	<update id="updateNewsDetails" parameterType="cn.uce.suc.common.entity.NoticeDetail">
		UPDATE t_suc_comm_notice_detail
		<set>
			<if test="contents != null">
			contents = #{contents},
			</if>
			<if test="readFlag != null">
			read_flag = #{readFlag},
			</if>
			<if test="title != null">
			title = #{title},
			</if>
			<if test="platform != null">
			platform = #{platform},
			</if>
			<if test="newsType != null">
			news_type = #{newsType},
			</if>
			<if test="deleteFlag != null">
			delete_flag = #{deleteFlag},
			</if>
			<if test="displayWays != null">
			display_ways = #{displayWays},
			</if>
		</set>
		<where>
			<if test="createTime != null">
				and create_time =#{createTime}
			</if>
			<if test="businessId != null">
				and business_id = #{businessId}
			</if>
		
		</where>
	</update>
</mapper>